# کنترل محتواي حساس

این ماژول برای بررسی محتوای ورودی توسط کاربران نهایی و محتوای خروجی LLM در برنامه استفاده می شود. این ماژول به دو نوع نقطه گسترش تقسیم می شود.

### نقاط گسترش

* `app.moderation.input` - نقطه گسترش برای بررسی محتوای ورودی کاربر نهایی
  * برای بررسی محتوای متغیر ارسال شده توسط کاربران نهایی و محتوای ورودی برنامه های گفتگوی استفاده می شود.
* `app.moderation.output` - نقطه گسترش برای بررسی محتوای خروجی LLM
  * برای بررسی محتوای خروجی شده توسط LLM استفاده می شود.
  * هنگامی که خروجی LLM به صورت جریان است، محتوا برای جلوگیری از تأخیر در بررسی خروجی های طولانی تر، به بلوک های 100 کاراکتری برای درخواست های API تقسیم می شود.

### نقطه گسترش `app.moderation.input`

#### بدنه درخواست

```
{
    "point": "app.moderation.input", // نوع نقطه گسترش، در اینجا به عنوان app.moderation.input ثابت است
    "params": {
        "app_id": string,  // شناسه برنامه
        "inputs": {  // مقادیر متغیر ارسال شده توسط کاربران نهایی، کلید نام متغیر است، مقدار مقدار متغیر است
            "var_1": "value_1",
            "var_2": "value_2",
            ...
        },
        "query": string | null  // محتوای ورودی گفتگوی فعلی از کاربر نهایی، پارامتر ثابت برای برنامه های گفتگو است.
    }
}
```

* مثال
  * ```
    {
        "point": "app.moderation.input",
        "params": {
            "app_id": "61248ab4-1125-45be-ae32-0ce91334d021",
            "inputs": {
                "var_1": "من تو را می کشم.",
                "var_2": "من تو را می کنم."
            },
            "query": "روزهای خوش."
        }
    }
    ```

#### پاسخ API

```
{
    "flagged": bool,  // آیا قوانین اعتدال را نقض می کند
    "action": string, // عملی که باید انجام شود، direct_output برای خروجی مستقیم یک پاسخ از پیش تعیین شده؛ overridden برای لغو مقادیر متغیر ورودی
    "preset_response": string,  // پاسخ از پیش تعیین شده (فقط هنگام action=direct_output برگردانده می شود)
    "inputs": {  // مقادیر متغیر ارسال شده توسط کاربران نهایی، کلید نام متغیر است، مقدار مقدار متغیر است (فقط هنگام action=overridden برگردانده می شود)
        "var_1": "value_1",
        "var_2": "value_2",
        ...
    },
    "query": string | null  // محتوای ورودی گفتگوی فعلی کاربر نهایی که لغو شده است، پارامتر ثابت برای برنامه های گفتگو است. (فقط هنگام action=overridden برگردانده می شود)
}
```

* مثال
  * `action=direct_output`
    * ```
      {
          "flagged": true,
          "action": "direct_output",
          "preset_response": "محتوای شما خط مشی استفاده ما را نقض می کند."
      }
      ```
  * `action=overridden`
    * ```
      {
          "flagged": true,
          "action": "overridden",
          "inputs": {
              "var_1": "من تو را *** می کنم.",
              "var_2": "من تو را *** می کنم."
          },
          "query": "روزهای خوش."
      }
      ```

### نقطه گسترش `app.moderation.output`

#### بدنه درخواست

```
{
    "point": "app.moderation.output", // نوع نقطه گسترش، در اینجا به عنوان app.moderation.output ثابت است
    "params": {
        "app_id": string,  // شناسه برنامه
        "text": string  // محتوای پاسخ LLM. هنگامی که خروجی LLM به صورت جریان است، این محتوا به بلوک های 100 کاراکتری تقسیم می شود.
    }
}
```

* مثال
  * ```
    {
        "point": "app.moderation.output",
        "params": {
            "app_id": "61248ab4-1125-45be-ae32-0ce91334d021",
            "text": "من تو را می کشم."
        }
    }
    ```

#### پاسخ API

```
{
    "flagged": bool,  // آیا قوانین اعتدال را نقض می کند
    "action": string, // عملی که باید انجام شود، direct_output برای خروجی مستقیم یک پاسخ از پیش تعیین شده؛ overridden برای لغو مقادیر متغیر ورودی
    "preset_response": string,  // پاسخ از پیش تعیین شده (فقط هنگام action=direct_output برگردانده می شود)
    "text": string  // محتوای پاسخ LLM که لغو شده است (فقط هنگام action=overridden برگردانده می شود)
}
```

* مثال
  * `action=direct_output`
    * ```
      {
          "flagged": true,
          "action": "direct_output",
          "preset_response": "محتوای شما خط مشی استفاده ما را نقض می کند."
      }
      ```
  * `action=overridden`
    * ```
      {
          "flagged": true,
          "action": "overridden",
          "text": "من تو را *** می کنم."
      }
      ```
