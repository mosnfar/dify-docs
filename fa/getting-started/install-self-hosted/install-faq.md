# سوالات متداول

### ۱. چگونه پسورد را ریست کنیم اگر مقداردهی اولیه‌ی استقرار محلی با پسورد اشتباه انجام نشود؟

اگر از طریق docker compose مستقر شده است، می توانید برای ریست کردن پسورد، دستور زیر را اجرا کنید: `docker exec -it docker-api-1 flask reset-password` ایمیل حساب کاربری و دو بار پسورد جدید را وارد کنید، و پسورد ریست خواهد شد.

### ۲. چگونه خطای "فایل یافت نشد" در لاگ هنگام استقرار محلی را حل کنیم؟

```
ERROR:root:Unknown Error in completion
Traceback (most recent call last):
  File "/www/wwwroot/dify/dify/api/libs/rsa.py", line 45, in decrypt
    private_key = storage.load(filepath)
  File "/www/wwwroot/dify/dify/api/extensions/ext_storage.py", line 65, in load
    raise FileNotFoundError("File not found")
FileNotFoundError: File not found
```

این خطا ممکن است به دلیل تغییر روش استقرار یا حذف فایل `api/storage/privkeys` اتفاق بیفتد. این فایل برای رمزگذاری کلیدهای مدل‌های بزرگ استفاده می‌شود و در صورت از بین رفتن قابل برگشت نیست. می‌توانید با استفاده از دستور زیر کلیدهای رمزگذاری عمومی و خصوصی را بازنشانی کنید:

* استقرار docker compose

```
docker exec -it docker-api-1 flask reset-encrypt-key-pair
```

* شروع کد منبع

وارد دایرکتوری api شوید

```
flask reset-encrypt-key-pair
```

دستورالعمل‌ها را برای ریست کردن دنبال کنید.

### ۳. هنگام نصب بعداً قادر به ورود نیستیم و پس از ورود موفقیت‌آمیز، رابط‌های بعدی ۴۰۱ را نشان می‌دهند؟

این ممکن است به دلیل تغییر نام دامنه/وب‌سایت باشد و باعث ایجاد cross-domain بین فرانت-اند و سمت سرور می‌شود. cross-domain و identity شامل دو مورد پیکربندی هستند:

**پیکربندی cross-domain CORS**

`CONSOLE_CORS_ALLOW_ORIGINS` سیاست cross-domain CORS کنسول، به طور پیش فرض `*` است که به دسترسی از همه نام دامنه‌ها اجازه می‌دهد. `WEB_API_CORS_ALLOW_ORIGINS` استراتژی cross-domain CORS WebAPP، به طور پیش فرض `*` است که به دسترسی از همه نام دامنه‌ها اجازه می‌دهد.

### ۴. پس از شروع، صفحه به طور مداوم در حال بارگذاری است و بررسی درخواست‌ها خطای CORS را نشان می‌دهد؟

این ممکن است به دلیل تغییر نام دامنه/URL باشد و باعث ایجاد cross-domain بین فرانت-اند و سمت سرور شود. لطفا تمام موارد پیکربندی زیر در `docker-compose.yml` را به نام دامنه جدید تغییر دهید: `CONSOLE_API_URL:` URL سمت سرور API کنسول. `CONSOLE_WEB_URL:` URL فرانت-اند وب کنسول. `SERVICE_API_URL:` URL API سرویس. `APP_API_URL:` URL سمت سرور API WebApp. `APP_WEB_URL:` URL WebApp.

برای اطلاعات بیشتر، لطفا [محیط‌ها](environments.md) را بررسی کنید.

### ۵. چگونه پس از استقرار نسخه را ارتقا دهیم؟

اگر از طریق تصاویر شروع به کار می‌کنید، لطفا جدیدترین تصاویر را برای تکمیل ارتقا بکشید. اگر از طریق کد منبع شروع به کار می‌کنید، لطفا جدیدترین کد را بکشید و سپس برای تکمیل ارتقا شروع به کار کنید.

هنگام استقرار و به‌روزرسانی کد منبع محلی، باید وارد دایرکتوری API شده و دستور زیر را برای مهاجرت ساختار پایگاه داده به آخرین نسخه اجرا کنید:

`flask db upgrade`

### ۶. چگونه متغیرهای محیطی را هنگام استفاده از واردات Notion پیکربندی کنیم؟

**سوال: آدرس پیکربندی ادغام Notion چیست؟**

**جواب: [https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)**

**سوال: چه متغیرهای محیطی نیاز به پیکربندی دارند؟**

**جواب: لطفا پیکربندی‌های زیر را هنگام استقرار خصوصی انجام دهید**

1. **`NOTION_INTEGRATION_TYPE`** : مقدار باید به عنوان (**عمومی/داخلی**) پیکربندی شود. از آنجایی که آدرس بازگردانی OAuth Notion فقط از https پشتیبانی می‌کند، اگر به صورت محلی مستقر شده است، لطفا از ادغام داخلی Notion استفاده کنید.
2. **`NOTION_CLIENT_SECRET`** : رمز مخفی کلاینت OAuth Notion (برای نوع ادغام عمومی استفاده می‌شود)
3. **`NOTION_CLIENT_ID`** : شناسه کلاینت OAuth (برای نوع ادغام عمومی استفاده می‌شود)
4. **`NOTION_INTERNAL_SECRET`** : رمز مخفی ادغام داخلی Notion، اگر مقدار `NOTION_INTEGRATION_TYPE` **داخلی** باشد، باید این متغیر را پیکربندی کنید.

### ۷. چگونه نام فضای کار در نسخه استقرار محلی را تغییر دهیم؟

در جدول `tenants` در پایگاه داده تغییر دهید.

### ۸. کجا می‌توانیم نام دامنه برای دسترسی به برنامه را تغییر دهیم؟

نام دامنه پیکربندی APP\_WEB\_URL را در `docker_compose.yaml` پیدا کنید.

### ۹. اگر مهاجرت پایگاه داده مورد نیاز باشد، چه مواردی نیاز به پشتیبان‌گیری دارند؟

پایگاه داده، ذخیره سازی پیکربندی شده و داده‌های پایگاه داده برداری نیاز به پشتیبان‌گیری دارند. اگر در حالت Docker Compose مستقر شده است، می‌توان تمام محتوای داده در دایرکتوری `dify/docker/volumes` را به طور مستقیم پشتیبان‌گیری کرد.

### ۱۰. چرا Docker در حال استقرار Dify و راه اندازی OpenLLM به صورت محلی با استفاده از 127.0.0.1 است، اما قادر به دسترسی به پورت محلی نیست؟

`127.0.0.1` آدرس داخلی کانتینر است و آدرس سروری که توسط Dify پیکربندی شده است، نیاز به آدرس IP شبکه محلی میزبان دارد.

### ۱۱. چگونه محدودیت‌های اندازه و تعداد برای آپلود اسناد دانش در نسخه استقرار محلی را حل کنیم؟

می‌توانید برای پیکربندی به توضیحات متغیرهای محیطی در مستندات رسمی وب سایت مراجعه کنید:

[محیط‌ها](environments.md)

### ۱۲. نسخه استقرار محلی چگونه اعضا را از طریق ایمیل دعوت می‌کند؟

نسخه استقرار محلی، اعضا را می‌توان از طریق ایمیل دعوت کرد. پس از وارد کردن دعوت نامه ایمیل، صفحه لینک دعوت را نشان می‌دهد، لینک دعوت را کپی کنید و آن را به کاربران ارسال کنید. اعضای تیم شما می‌توانند با تنظیم رمز عبور از طریق ورود به ایمیل، لینک را باز کرده و وارد فضای کار شما شوند.

### ۱۳. چگونه خطای listen tcp4 0.0.0.0:80: bind: address already in use را حل کنیم؟

این به این دلیل است که پورت اشغال شده است. می‌توانید از دستور `netstat -tunlp | grep 80` برای مشاهده فرآیندی که پورت را اشغال کرده است، استفاده کنید و سپس فرآیند را بکشید. به عنوان مثال، فرآیندهای apache و nginx پورت را اشغال می‌کنند، می‌توانید از دستورات `service apache2 stop` و `service nginx stop` برای متوقف کردن فرآیند استفاده کنید.

### ۱۴. اگر این خطا در متن به گفتار رخ دهد چه باید کرد؟

```
[openai] Error: ffmpeg is not installed
```

از آنجایی که OpenAI TTS تقسیم‌بندی جریان صوتی را اجرا کرده است، FFmpeg برای استفاده عادی هنگام استقرار کد منبع باید نصب شود. در اینجا مراحل دقیق ارائه شده است:

**ویندوز:**

1. از [وب‌سایت رسمی FFmpeg](https://ffmpeg.org/download.html) دیدن کنید و کتابخانه اشتراکی ویندوز کامپایل شده از قبل را دانلود کنید.
2. پوشه FFmpeg را دانلود و از حالت فشرده خارج کنید، که پوشه‌ای مشابه "ffmpeg-20200715-51db0a4-win64-static" را ایجاد می‌کند.
3. پوشه از حالت فشرده خارج شده را به یک مکان دلخواه منتقل کنید، مثلا C:\Program Files.
4. مسیر مطلق دایرکتوری bin FFmpeg را به متغیرهای محیطی سیستم اضافه کنید.
5. خط فرمان را باز کنید و "ffmpeg -version" را وارد کنید تا ببینید که آیا اطلاعات نسخه FFmpeg نمایش داده می‌شود یا خیر، که نشان می‌دهد نصب با موفقیت انجام شده است.

**اوبونتو:**

1. ترمینال را باز کنید.
2. برای نصب FFmpeg دستورات زیر را وارد کنید: `sudo apt-get update`, سپس `sudo apt-get install ffmpeg` را وارد کنید.
3. "ffmpeg -version" را وارد کنید تا بررسی کنید که آیا با موفقیت نصب شده است یا خیر.

**CentOS:**

1. ابتدا باید مخزن EPEL را فعال کنید. در ترمینال، `sudo yum install epel-release` را وارد کنید.
2. سپس `sudo rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm` را وارد کنید.
3. بسته yum را به‌روزرسانی کنید، `sudo yum update` را وارد کنید.
4. در نهایت FFmpeg را نصب کنید، `sudo yum install ffmpeg ffmpeg-devel` را وارد کنید.
5. "ffmpeg -version" را وارد کنید تا بررسی کنید که آیا با موفقیت نصب شده است یا خیر.

**Mac OS X:**

1. ترمینال را باز کنید.
2. اگر هنوز Homebrew را نصب نکرده‌اید، می‌توانید با وارد کردن دستور زیر در ترمینال آن را نصب کنید: `/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"`
3. FFmpeg را با Homebrew نصب کنید، `brew install ffmpeg` را وارد کنید.
4. "ffmpeg -version" را وارد کنید تا بررسی کنید که آیا با موفقیت نصب شده است یا خیر.

### ۱۵. مهاجرت پایگاه داده برداری به Qdrant یا Milvus

اگر می‌خواهید پایگاه داده برداری را از weaviate به qdrant یا milvus مهاجرت کنید، باید داده‌ها را در پایگاه داده برداری مهاجرت کنید. در اینجا روش مهاجرت آمده است:

مراحل:

1. اگر از کد منبع محلی شروع می‌کنید، متغیر محیطی را در فایل `.env` به پایگاه داده برداری که می‌خواهید به آن مهاجرت کنید، تغییر دهید. به عنوان مثال: `VECTOR_STORE=qdrant`
2. اگر از docker-compose شروع می‌کنید، متغیر محیطی را در فایل `docker-compose.yaml` به پایگاه داده برداری که می‌خواهید به آن مهاجرت کنید، تغییر دهید، هم api و هم worker هر دو نیاز دارند. به عنوان مثال:

```
# نوع ذخیره سازی برداری که باید استفاده شود. مقادیر پشتیبانی شده عبارتند از `weaviate`, `qdrant`, `milvus`.
VECTOR_STORE: weaviate
```

3. دستور زیر را در ترمینال یا کانتینر docker خود اجرا کنید

```
flask vdb-migrate # or docker exec -it docker-api-1 flask vdb-migrate
```

### ۱۶. چرا SSRF_PROXY لازم است؟

شاید متغیر محیطی `SSRF_PROXY` را در فایل `docker-compose.yaml` مشاهده کرده باشید. این امر بسیار مهم است زیرا استقرار محلی Dify از `SSRF_PROXY` برای جلوگیری از حملات SSRF (درخواست سرور از سرور) استفاده می‌کند. برای اطلاعات بیشتر در مورد حملات SSRF، به [این منبع](https://portswigger.net/web-security/ssrf) مراجعه کنید.

برای کاهش خطرات احتمالی، یک پروکسی برای تمام خدماتی که ممکن است در معرض حملات SSRF باشند، راه‌اندازی کرده‌ایم. این پروکسی تضمین می‌کند که خدماتی مانند Sandbox فقط می‌توانند از طریق آن به شبکه‌های خارجی دسترسی داشته باشند و در نتیجه داده‌ها و خدمات شما را محافظت می‌کند. به طور پیش فرض، این پروکسی هیچ درخواست محلی را رهگیری نمی‌کند. با این حال، می‌توانید با اصلاح فایل پیکربندی `squid` رفتار پروکسی را سفارشی کنید.

#### نحوه سفارشی کردن رفتار پروکسی؟

در فایل `docker/volumes/ssrf_proxy/squid.conf`، تنظیمات پیکربندی پروکسی را خواهید یافت. به عنوان مثال، اگر می‌خواهید به شبکه `192.168.101.0/24` اجازه دهید از طریق پروکسی دسترسی داشته باشد، اما دسترسی به آدرس IP `192.168.101.19` که حاوی داده‌های حساس است را محدود کنید، می‌توانید قوانین زیر را به `squid.conf` اضافه کنید:

```plaintext
acl restricted_ip dst 192.168.101.19
acl localnet src 192.168.101.0/24

http_access deny restricted_ip
http_access allow localnet
http_access deny all
```

این یک مثال اساسی است، و می‌توانید قوانین را برای برآورده کردن نیازهای خاص خود سفارشی کنید. برای اطلاعات بیشتر در مورد پیکربندی `squid`، به [مستندات رسمی](http://www.squid-cache.org/Doc/config/) مراجعه کنید.



