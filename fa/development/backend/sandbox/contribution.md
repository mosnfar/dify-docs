# مشارکت

### ساختار کد
ساختار فایل کد زیر نشان‌دهنده سازماندهی پروژه است:
```
[cmd/]
├── server                // نقطه شروع راه‌اندازی سرور
├── lib                   // نقطه شروع کتابخانه مشترک
└── test                  // اسکریپت‌های تست مشترک
[build/]                  // اسکریپت‌های ساخت برای معماری‌ها و پلتفرم‌های مختلف
[internal/]               // بسته‌های داخلی
├── controller            // هندلرهای درخواست HTTP
├── middleware            // میان‌افزار پردازش درخواست
├── server                // تنظیمات و پیکربندی سرور
├── service               // سرویس‌های کنترلر
├── static                // فایل‌های پیکربندی
│   ├── nodejs_syscall    // لیست سفید تماس‌های سیستمی Node.js
│   └── python_syscall    // لیست سفید تماس‌های سیستمی پایتون
├── types                 // تعاریف موجودیت
├── core                  // منطق اصلی جداسازی و اجرا
│   ├── lib               // کتابخانه‌های مشترک
│   ├── runner            // اجرای کد
│   │   ├── nodejs        // مجری Node.js
|   |   └── python        // مجری پایتون
└── tests                 // تست‌های CI/CD
```

### اصول
کارایی اصلی دو نقطه ورود دارد: ورودی سرویس `HTTP` برای `DifySandbox` و ورودی `کتابخانه لینک دینامیک`. زمانی که Sandbox کدی را اجرا می‌کند، ابتدا یک فایل کد موقت ایجاد می‌کند. این فایل با فراخوانی `کتابخانه لینک دینامیک` برای راه‌اندازی محیط زمان اجرا (Sandbox) شروع می‌شود. سپس کد کاربر در این فایل موقت اجرا می‌شود، و این اطمینان حاصل می‌شود که سیستم در برابر کدهای احتمالی مضر ارسالی از سوی کاربر محافظت می‌شود.

کتابخانه لینک دینامیک از `Seccomp` برای محدود کردن تماس‌های سیستمی استفاده می‌کند. دایرکتوری `static` حاوی فایل‌های `nodejs_syscall` و `python_syscall` است که لیست‌های سفید تماس‌های سیستمی را برای هر دو معماری `ARM64` و `AMD64` ارائه می‌کنند. در مجموع چهار فایل وجود دارد. لطفا در صورت لزوم این فایل‌ها را اصلاح نکنید.

### نحوه مشارکت
برای مشکلات جزئی مانند `تایپو` و `باگ`، می‌توانید یک `درخواست ادغام` ارسال کنید. برای تغییرات اساسی یا ارسال‌های سطح `ویژگی`، لطفا ابتدا یک `issue` باز کنید تا بحث تسهیل شود.

#### لیست کارها
در اینجا چند موردی که در حال حاضر در نظر داریم آورده شده است. اگر علاقه‌مند هستید، می‌توانید یکی از آنها را برای مشارکت انتخاب کنید:
- [ ] پشتیبانی از زبان‌های برنامه‌نویسی اضافی:
    - در حال حاضر از `پایتون` و `Node.js` پشتیبانی می‌کنیم. در نظر بگیرید که پشتیبانی از زبان‌های جدید را اضافه کنید.
    - به یاد داشته باشید که هر دو معماری `ARM64` و `AMD64` را در نظر بگیرید، و آزمایش‌های `CI` را برای اطمینان از امنیت هر زبان جدید ارائه کنید.
- [ ] مدیریت وابستگی‌های Node.js:
    - پشتیبانی از وابستگی‌های `پایتون` را پیاده‌سازی کرده‌ایم که می‌توانند به طور خودکار در حین راه‌اندازی Sandbox نصب شوند. با این حال، به دلیل پیچیدگی `node_modules`، هنوز راه حل مناسبی برای `Node.js` پیدا نکرده‌ایم. این حوزه برای بهبود باز است.
- [ ] قابلیت‌های پردازش تصویر:
    - با توجه به اهمیت روزافزون چندوجهی، پشتیبانی از پردازش تصویر در Sandbox ارزشمند خواهد بود.
    - در نظر بگیرید که پشتیبانی از کتابخانه‌های پردازش تصویر مانند `Pillow` را اضافه کنید، و امکان ارسال تصاویر به Sandbox برای پردازش در Dify را فراهم کنید.
- [ ] تست‌های CI پیشرفته:
    - تست‌های CI فعلی ما محدود هستند و فقط شامل موارد تست اولیه هستند. تست‌های جامع‌تر مفید خواهد بود.
- [ ] تولید داده‌های چندوجهی:
    - استفاده از Sandbox برای تولید داده‌های چندوجهی مانند ترکیب متن و تصاویر را بررسی کنید.

