# حالت حرفه‌ای برای مهندسی اعلان (متوقف شده)

هنگام ایجاد یک برنامه در Dify، حالت تنظیم پیش‌فرض **حالت ساده** است که برای کاربران غیر فنی که می‌خواهند به سرعت برنامه‌هایی مانند یک ربات چت پایگاه دانش شرکت یا یک خلاصه ساز مقاله ایجاد کنند، ایده‌آل است. با استفاده از **حالت ساده**، می‌توانید عبارات پیش‌اعلان را تنظیم کنید، متغیرها و زمینه را با مراحل ساده اضافه کنید تا یک برنامه کامل را منتشر کنید (به 👉[conversation-application.md](../../../../guides/application_orchestrate/conversation-application.md "mention")) مراجعه کنید.

با این حال، اگر شما یک کاربر فنی هستید که در استفاده از **OpenAI's** **Playground** مهارت دارید و می‌خواهید یک برنامه آموزگار ایجاد کنید که برای ماژول‌های مختلف آموزشی نیاز به جاسازی زمینه‌ها و متغیرهای مختلف در اعلان‌ها دارد، می‌توانید **حالت حرفه‌ای** را انتخاب کنید. در این حالت، می‌توانید آزادانه اعلان‌های کامل را بنویسید، از جمله اصلاح اعلان‌های داخلی، تنظیم موقعیت زمینه و تاریخچه چت در اعلان‌ها و تنظیم پارامترهای لازم. اگر با هر دو مدل چت و تکمیل متن آشنا هستید، **حالت حرفه‌ای** به شما امکان می‌دهد تا به سرعت بین این مدل‌ها برای رفع نیازهای خود جابجا شوید، و هر دو برای برنامه‌های مکالمه‌ای و تولید متن مناسب هستند.

قبل از شروع آزمایش با حالت جدید، باید عناصر ضروری **حالت حرفه‌ای** را بدانید:

* **مدل تکمیل متن** ![](../../../../.gitbook/assets/screenshot-20231017-092613.png)

  هنگام انتخاب یک مدل، نامی که در سمت راست آن COMPLETE وجود دارد، یک مدل تکمیل متن است. این مدل یک رشته متن آزاد به نام "اعلان" را می‌پذیرد و یک تکمیل متن را تولید می‌کند که سعی می‌کند با هر زمینه یا الگویی که به آن می‌دهید مطابقت کند. به عنوان مثال، اگر اعلان شما این است: "همانطور که دکارت گفت، من فکر می‌کنم، پس"، احتمالاً "من هستم" را به عنوان تکمیل برمی‌گرداند.
* **مدل چت** <img src="../../../../.gitbook/assets/screenshot-20231017-092957.png" alt="" data-size="line">

  هنگام انتخاب یک مدل، نامی که در سمت راست آن CHAT وجود دارد، یک مدل چت است. این مدل لیستی از پیام‌ها را به عنوان ورودی می‌پذیرد و یک پیام تولید شده را به عنوان خروجی برمی‌گرداند. اگرچه فرمت چت برای ساده سازی مکالمات چند دوره‌ای طراحی شده است، اما برای وظایف تک دوره‌ای بدون هیچ مکالمه‌ای نیز مفید است. مدل‌های چت از پیام‌های چت به عنوان ورودی و خروجی استفاده می‌کنند، از جمله سه نوع پیام: SYSTEM، USER و ASSISTANT:

  * `SYSTEM`
    * پیام‌های سیستم به تنظیم رفتار دستیار هوش مصنوعی کمک می‌کنند. به عنوان مثال، می‌توانید شخصیت دستیار هوش مصنوعی را اصلاح کنید یا دستورالعمل‌های خاصی را در مورد چگونگی رفتار آن در طول مکالمه ارائه دهید. پیام‌های سیستم اختیاری هستند و رفتار مدل بدون پیام‌های سیستم ممکن است شبیه استفاده از یک پیام عمومی مانند "شما یک دستیار مفید هستید" باشد.
  * `USER`
    * پیام‌های کاربر درخواست‌ها یا نظرات را برای پاسخ دستیار هوش مصنوعی ارائه می‌دهند.
  * `ASSISTANT`
    * پیام‌های دستیار پاسخ‌های قبلی دستیار را ذخیره می‌کنند، اما می‌توانند توسط شما نیز برای ارائه نمونه‌هایی از رفتار مورد نظر نوشته شوند.
* **توالی‌های توقف**

  اینها کلمات، عبارات یا کاراکترهای خاص هستند که برای علامت دادن به LLM برای توقف تولید متن استفاده می‌شوند.
* **بلوک‌های محتوا در اعلان‌های حالت حرفه‌ای**
  *   <img src="../../../../.gitbook/assets/3.png" alt="" data-size="line">

      در یک برنامه که با یک مجموعه داده تنظیم شده است، کاربر یک پرس‌وجو را وارد می‌کند و برنامه از این پرس‌وجو به عنوان یک شرط بازیابی برای مجموعه داده استفاده می‌کند. نتایج بازیابی شده سازماندهی می‌شوند و متغیر `context` را جایگزین می‌کنند، به LLM اجازه می‌دهند تا به محتوای زمینه برای ارائه پاسخ مراجعه کند.
  *   <img src="../../../../.gitbook/assets/4.png" alt="" data-size="line">

      محتوای پرس‌وجو فقط در مدل‌های تکمیل متن برای برنامه‌های مکالمه‌ای در دسترس است. محتوای وارد شده توسط کاربر در مکالمه این متغیر را جایگزین می‌کند و یک دور جدید از گفتگو را آغاز می‌کند.
  *   <img src="../../../../.gitbook/assets/5.png" alt="" data-size="line">

      تاریخچه مکالمه فقط در مدل‌های تکمیل متن برای برنامه‌های مکالمه‌ای در دسترس است. در طول مکالمات متعدد در یک برنامه مکالمه‌ای، Dify سوابق مکالمه تاریخی را با توجه به قوانین داخلی مونتاژ و زنجیر می‌کند و متغیر `conversation history` را جایگزین می‌کند. پیشوندهای Human و Assistant را می‌توان با کلیک بر روی `...` بعد از `conversation history` اصلاح کرد.
* **قالب اولیه**

  در **حالت حرفه‌ای**، قبل از تنظیم رسمی، کادر اعلان یک قالب اولیه ارائه می‌دهد که می‌توانید مستقیماً آن را برای ارائه درخواست‌های سفارشی‌تر به LLM تغییر دهید. توجه داشته باشید: تفاوت‌هایی بر اساس نوع برنامه و حالت وجود دارد.

  برای جزئیات بیشتر، لطفا به 👉[prompt-engineering-template.md](prompt-engineering-template.md "mention") مراجعه کنید.

## مقایسه دو حالت

| بعد مقایسه | حالت ساده | حالت حرفه‌ای |
|----------------------|-------------|-------------|
| دیده‌شدن اعلان داخلی | محصور و نامرئی | باز و قابل مشاهده |
| تنظیم خودکار | در دسترس | در دسترس نیست |
| تفاوت در انتخاب مدل تکمیل متن و چت | هیچ | تنظیمات متفاوت بعد از انتخاب مدل تکمیل متن و چت |
| درج متغیر | در دسترس | در دسترس |
| تأیید بلوک‌های محتوا | هیچ | در دسترس |
| تنظیم نوع پیام SYSTEM / USER / ASSISTANT | هیچ | در دسترس |
| تنظیمات پارامترهای زمینه | قابل تنظیم | قابل تنظیم |
| مشاهده PROMPT LOG | مشاهده کامل لاگ اعلان | مشاهده کامل لاگ اعلان |
| تنظیمات پارامترهای توالی‌های توقف | هیچ | قابل تنظیم |

## دستورالعمل‌های عملیاتی

### 1. نحوه ورود به حالت حرفه‌ای

بعد از ایجاد یک برنامه، می‌توانید در صفحه تنظیم اعلان به **حالت حرفه‌ای** تغییر وضعیت دهید، جایی که می‌توانید اعلان‌های کامل برنامه را ویرایش کنید.

<figure><img src="../../../../.gitbook/assets/专家模式.png" alt=""><figcaption><p>ورود به حالت حرفه‌ای</p></figcaption></figure>

{% hint style="warning" %}
بعد از تغییر اعلان‌ها و انتشار برنامه در **حالت حرفه‌ای**، نمی‌توانید به **حالت ساده** برگردید.
{% endhint %}

### 2. تغییر پارامترهای زمینه درج شده

در هر دو **حالت ساده** و **حالت حرفه‌ای**، می‌توانید پارامترهای زمینه درج شده را شامل **TopK** و **Score Threshold** را تغییر دهید.

{% hint style="warning" %}
توجه داشته باشید که اعلان داخلی حاوی \{{#context#\}} فقط بعد از آپلود زمینه در **حالت حرفه‌ای** نمایش داده می‌شود.
{% endhint %}

<figure><img src="../../../../.gitbook/assets/参数设置.png" alt=""><figcaption><p>تنظیمات پارامترهای زمینه</p></figcaption></figure>

**TopK: محدوده مقدار یک عدد صحیح از 1 تا 10 است**

برای فیلتر کردن قطعات متن با بیشترین شباهت به پرس‌وجوی کاربر استفاده می‌شود. سیستم تعداد قطعات را بر اساس اندازه پنجره زمینه مدل انتخاب شده به طور پویا تنظیم می‌کند. مقدار پیش‌فرض 2 است. توصیه می‌شود این مقدار را بین 2 و 5 تنظیم کنید، زیرا انتظار داریم پاسخ‌هایی را دریافت کنیم که بیشتر با زمینه جاسازی شده مطابقت دارند.

**Score Threshold: محدوده مقدار یک عدد اعشاری با دو رقم اعشار از 0 تا 1 است**

برای تنظیم آستانه شباهت برای فیلتر کردن قطعات متن استفاده می‌شود، یعنی فقط یادآوری قطعات متنی که از نمره تنظیم شده فراتر می‌روند (می‌توانید نمره اصابت هر قطعه را در "Hit Test" مشاهده کنید). سیستم به طور پیش‌فرض این تنظیم را خاموش می‌کند، به این معنی که قطعات متن یادآوری شده را بر اساس مقدار شباهت فیلتر نمی‌کند. هنگام روشن بودن، مقدار پیش‌فرض 0.7 است. توصیه می‌شود این تنظیم را به طور پیش‌فرض خاموش نگه دارید، اما اگر به پاسخ‌های دقیق‌تر نیاز دارید، می‌توانید یک مقدار بالاتر را تنظیم کنید (حداکثر مقدار 1 است، اما توصیه نمی‌شود که آن را خیلی بالا تنظیم کنید).

### 3. تنظیم **توالی‌های توقف**

ما نمی‌خواهیم LLM محتوای غیرضروری را تولید کند، بنابراین کلمات، عبارات یا کاراکترهای خاص (تنظیم پیش‌فرض `Human:`) باید تنظیم شوند تا به LLM اطلاع دهند که تولید متن را متوقف کند.

به عنوان مثال، اگر یک اعلان _Few-Shot_ می‌نویسید:

```
Human1: رنگ آسمان چیست؟
Assistant1: آسمان آبی است.
Human1: رنگ آتش چیست؟
Assistant1: آتش قرمز است.
Human1: رنگ خاک چیست؟
Assistant1: 
```

سپس در `Stop Sequences` پارامترهای مدل، `Human1:` را وارد کنید و کلید "Tab" را فشار دهید.

به این ترتیب، LLM فقط با یک جمله پاسخ خواهد داد:

```
Assistant1: خاک زرد است.
```

و هیچ گفتگوی دیگری را تولید نخواهد کرد (یعنی LLM تولید محتوا را قبل از رسیدن به "Human1:" بعدی متوقف می‌کند).

### 4. درج سریع متغیرها و بلوک‌های محتوا

در **حالت حرفه‌ای**، می‌توانید "`/`" را در ویرایشگر متن تایپ کنید تا به سرعت بلوک‌های محتوا را برای درج در اعلان نمایش دهید. بلوک‌های محتوا شامل: `context`، `variable`، `conversation history`، `query content` هستند. همچنین می‌توانید "`{`" را تایپ کنید تا به سرعت لیستی از متغیرهای قبلاً ایجاد شده را درج کنید.

<figure><img src="../../../../.gitbook/assets/快捷键.png" alt=""><figcaption><p>کلید میانبر “/”</p></figcaption></figure>

{% hint style="warning" %}
بلوک‌های محتوا به غیر از "متغیرها" را نمی‌توان به طور مکرر درج کرد. بلوک‌های محتوای در دسترس ممکن است بر اساس ساختار قالب اعلان در برنامه‌ها و مدل‌های مختلف متفاوت باشد. `Conversation history` و `query content` فقط در مدل‌های تکمیل متن برای برنامه‌های مکالمه‌ای در دسترس هستند.
{% endhint %}

### 5. ورودی پیش‌اعلان

قالب اولیه اعلان سیستم پارامترهای لازم و الزامات پاسخ LLM را ارائه می‌دهد. برای جزئیات بیشتر، به 👉[prompt-engineering-template.md](prompt-engineering-template.md "mention") مراجعه کنید.

هسته اولیه تنظیم توسط توسعه دهندگان پیش‌اعلان است که باید ویرایش شود و در اعلان داخلی درج شود. موقعیت پیشنهادی درج به شرح زیر است (با استفاده از ایجاد یک "iPhone Consultation Customer Service" به عنوان مثال):

```
هنگام پاسخ دادن به کاربر:
- اگر نمی‌دانید، فقط بگویید که نمی‌دانید.
- اگر نمی‌دانید یا مطمئن نیستید، برای روشن شدن موضوع سوال بپرسید.
از ذکر اینکه اطلاعات را از زمینه به دست آورده‌اید خودداری کنید.
و با توجه به زبان پرس‌وجوی کاربر پاسخ دهید.

شما یک دستیار خدمات مشتری برای اپل اینک هستید و می‌توانید خدمات مشاوره برای آیفون‌ها ارائه دهید.
هنگام پاسخ دادن، باید پارامترهای دقیق آیفون را فهرست کنید و باید این اطلاعات را به عنوان یک جدول MARKDOWN عمودی خروجی کنید. اگر لیست خیلی طولانی است، آن را رونویسی کنید.
مجاز هستید برای تولید یک خروجی معقول‌تر، مدت زمان طولانی فکر کنید.
توجه: در حال حاضر شما فقط اطلاعاتی در مورد برخی مدل‌های آیفون دارید، نه همه آنها.
```

البته، می‌توانید قالب اولیه را نیز سفارشی کنید، به عنوان مثال، اگر می‌خواهید پاسخ‌های LLM به زبان انگلیسی باشد، می‌توانید اعلان داخلی را به شرح زیر تغییر دهید:

```
هنگام پاسخ دادن به کاربر:
- If you don't know, just say that you don't know.
- If you don't know or are not sure, ask for clarification.
Avoid mentioning that you obtained the information from the context.
And answer according to the language English.
```

### 6. لاگ‌های اشکال زدایی

در حین اشکال زدایی تنظیم، نه تنها می‌توانید ورودی کاربر و پاسخ LLM را مشاهده کنید. در **حالت حرفه‌ای**، با کلیک بر روی آیکون در سمت چپ بالای دکمه ارسال پیام، می‌توانید اعلان کامل را مشاهده کنید و این کار برای توسعه دهندگان آسان‌تر می‌کند تا تأیید کنند که آیا محتوای متغیر ورودی، زمینه، تاریخچه چت و محتوای پرس‌وجو مطابق با انتظارات است. برای توضیح دقیق لیست لاگ‌ها، لطفا به مستندات لاگ 👉 مراجعه کنید: [logs.md](../../../../guides/biao-zhu/logs.md "mention")

#### 6.1 **مشاهده لاگ‌های اشکال زدایی**

در رابط پیش‌نمایش اشکال زدایی، بعد از یک مکالمه بین کاربر و هوش مصنوعی، نشانگر ماوس را به هر جلسه کاربر منتقل کنید و دکمه آیکون "Log" را در سمت چپ بالا مشاهده خواهید کرد. برای مشاهده لاگ اعلان، روی آن کلیک کنید.

<figure><img src="../../../../.gitbook/assets/日志.png" alt=""><figcaption><p>ورود به لاگ اشکال زدایی</p></figcaption></figure>

در لاگ، می‌توانید به وضوح مشاهده کنید:

* اعلان کامل داخلی
* قطعات متن مرتبط که در جلسه فعلی به آنها ارجاع داده شده است
* سوابق مکالمه تاریخی

<figure><img src="../../../../.gitbook/assets/11.png" alt=""><figcaption><p>مشاهده لاگ اعلان در رابط پیش‌نمایش اشکال زدایی</p></figcaption></figure>

از لاگ، می‌توانید اعلان کامل ارسال شده به LLM را بعد از مونتاژ سیستم مشاهده کنید و به طور مداوم ورودی اعلان را بر اساس نتایج اشکال زدایی بهبود بخشید.

#### **6.2 تاریخچه اشکال زدایی ردیابی**

در رابط اصلی برای ساخت اولیه برنامه، می‌توانید "Logs and Annotations" را در نوار ناوبری سمت چپ مشاهده کنید. برای مشاهده کامل لاگ‌ها روی آن کلیک کنید. در رابط اصلی لاگ‌ها و حاشیه نویسی‌ها، روی هر ورودی لاگ مکالمه کلیک کنید، و در کادر گفتگوی سمت راست پاپ‌آپ، نشانگر ماوس را به مکالمه منتقل کنید تا دکمه "Log" را کلیک کنید تا لاگ اعلان را مشاهده کنید.

<figure><img src="../../../../.gitbook/assets/12.png" alt=""><figcaption><p>مشاهده لاگ اعلان در رابط Logs and Annotations</p></figcaption></figure>

