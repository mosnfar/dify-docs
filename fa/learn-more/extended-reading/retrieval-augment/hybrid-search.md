# جستجوی ترکیبی

### چرا جستجوی ترکیبی لازم است؟

روش اصلی در مرحله بازیابی RAG (تولید تقویت شده با بازیابی) جستجوی برداری است که بر اساس ارتباط معنایی تطبیق انجام می دهد. اصل فنی شامل تقسیم اسناد در پایگاه دانش خارجی به پاراگراف ها یا جملات معنایی کامل، تبدیل آنها به یک سری اعداد (بردارهای چند بعدی) که کامپیوتر می تواند آنها را درک کند و انجام همان تبدیل بر روی پرس و جوی کاربر است.

کامپیوتر می تواند روابط معنایی ظریف بین پرس و جوی کاربر و جملات را تشخیص دهد. به عنوان مثال، "گربه ها موش ها را تعقیب می کنند" و "گربه های کوچک موش ها را شکار می کنند" ارتباط معنایی بالاتری نسبت به "گربه ها موش ها را تعقیب می کنند" و "من دوست دارم ژامبون بخورم" خواهند داشت. بعد از یافتن محتوا متن مرتبط ترین، سیستم RAG آن را به عنوان متن برای پرس و جوی کاربر به مدل بزرگ ارائه می دهد و به آن کمک می کند تا به سوال پاسخ دهد.

علاوه بر فعال کردن بازیابی متن معنایی پیچیده، جستجوی برداری مزایای دیگری نیز دارد:

* درک معنایی مشابه (به عنوان مثال، موش/تله موش/پنیر، گوگل/بینگ/موتور جستجو)
* درک چند زبانه (درک بین زبانی، مانند تطبیق ورودی انگلیسی با چینی)
* درک چند وجهی (پشتیبانی از تطبیق مشابه متن، تصاویر، صدا، ویدیو و غیره)
* تحمل خطا (پردازش خطاهای املایی و توضیحات مبهم)

در حالی که جستجوی برداری در سناریوهای فوق مزایای واضحی دارد، در برخی از شرایط مانند موارد زیر ضعیف عمل می کند:

* جستجو برای نام افراد یا اشیاء (به عنوان مثال، ایلان ماسک، آیفون 15)
* جستجو برای اختصارات یا عبارات (به عنوان مثال، RAG، RLHF)
* جستجو برای شناسه ها (به عنوان مثال، `gpt-3.5-turbo`, `titan-xlarge-v1.01`)

این نقاط ضعف دقیقا نقاط قوت جستجوی کلمه کلیدی سنتی هستند که در موارد زیر برتری دارند:

* تطبیق دقیق (به عنوان مثال، نام محصولات، نام افراد، شماره محصولات)
* تطبیق با چند کاراکتر (جستجوی برداری با چند کاراکتر عملکرد ضعیفی دارد، اما بسیاری از کاربران تمایل دارند فقط چند کلمه کلیدی را وارد کنند)
* تطبیق با کلمات کم فرکانس (کلمات کم فرکانس اغلب معنی مهمی در زبان دارند، مانند "آیا دوست دارید با من قهوه بنوشید؟" که "داشتن" و "قهوه" اهمیت بیشتری نسبت به "شما" و "دوست داشتن" دارند)

برای اکثر سناریوهای جستجوی متن، هدف اصلی اطمینان از این است که مرتبط ترین نتایج بالقوه در نتایج کاندید ظاهر می شوند. جستجوی برداری و جستجوی کلمه کلیدی هر کدام مزایای خود را در زمینه بازیابی دارند. جستجوی ترکیبی نقاط قوت هر دو فناوری جستجو را در کنار هم قرار می دهد و نقاط ضعف آنها را جبران می کند.

در جستجوی ترکیبی، شما باید شاخص های برداری و شاخص های کلمه کلیدی را از قبل در پایگاه داده ایجاد کنید. هنگامی که یک پرس و جوی کاربری وارد می شود، مرتبط ترین متون از اسناد با استفاده از هر دو روش بازیابی بازیابی می شوند.

<figure><img src="../../../.gitbook/assets/image (127).png" alt="" width="563"><figcaption><p>جستجوی ترکیبی</p></figcaption></figure>

"جستجوی ترکیبی" تعریف دقیقی ندارد. این مقاله از ترکیب جستجوی برداری و جستجوی کلمه کلیدی به عنوان یک مثال استفاده می کند. اگر از ترکیبات دیگری از الگوریتم های جستجو استفاده کنیم، می توان آن را "جستجوی ترکیبی" نامید. به عنوان مثال، می توانیم تکنیک های نمودار دانش را برای بازیابی روابط موجودیت با تکنیک های جستجوی برداری ترکیب کنیم.

سیستم های بازیابی مختلف در یافتن روابط ظریف مختلف بین متون (پاراگراف ها، جملات، کلمات) مهارت دارند، از جمله روابط دقیق، روابط معنایی، روابط موضوعی، روابط ساختاری، روابط موجودیت، روابط زمانی، روابط رویداد و غیره. هیچ حالت بازیابی واحدی نمی تواند برای تمام سناریوها مناسب باشد. **جستجوی ترکیبی با ترکیب چندین سیستم بازیابی، مکمل بودن بین چندین فناوری بازیابی را به دست می آورد.**

### جستجوی برداری

تعریف: ایجاد تعبیه پرس و جوی و پرس و جو از بخش های متنی که بیشترین شباهت را به نمایش برداری برداری آنها دارند.

<figure><img src="../../../.gitbook/assets/image (116).png" alt="" width="563"><figcaption><p>تنظیمات جستجوی برداری</p></figcaption></figure>

**TopK:** برای فیلتر کردن بخش های متنی که بیشترین شباهت را به پرس و جوی کاربر دارند، استفاده می شود. سیستم به طور پویا تعداد بخش ها را بر اساس اندازه پنجره متن مدل انتخاب شده تنظیم می کند. مقدار پیش فرض 3 است.

**آستانه امتیاز:** برای تنظیم آستانه شباهت برای فیلتر کردن بخش های متنی استفاده می شود، یعنی فقط بازیابی بخش های متنی که از امتیاز تعیین شده فراتر می روند. پیش فرض سیستم غیرفعال کردن این تنظیم است، به این معنی که مقادیر شباهت بخش های متنی بازیابی شده را فیلتر نمی کند. هنگامی که فعال می شود، مقدار پیش فرض 0.5 است.

**مدل Rerank:** بعد از پیکربندی کلید API مدل Rerank در صفحه "ارائه دهندگان مدل"، می توانید "مدل Rerank" را در تنظیمات بازیابی فعال کنید. سیستم بعد از بازیابی معنایی، re-ranking معنایی را بر روی نتایج اسناد بازیابی شده انجام می دهد تا نتایج رتبه بندی بهینه سازی شوند. هنگامی که مدل Rerank تنظیم می شود، تنظیمات TopK و آستانه امتیاز فقط در مرحله Rerank اثر دارند.

### جستجوی متن کامل

تعریف: شاخص گذاری تمام کلمات در سند، به کاربر اجازه می دهد هر کلمه ای را پرس و جو کند و بخش های متنی حاوی آن کلمات را بازگرداند.

<figure><img src="../../../.gitbook/assets/image (122).png" alt="" width="563"><figcaption><p>تنظیمات جستجوی متن کامل</p></figcaption></figure>

**TopK:** برای فیلتر کردن بخش های متنی که بیشترین شباهت را به پرس و جوی کاربر دارند، استفاده می شود. سیستم به طور پویا تعداد بخش ها را بر اساس اندازه پنجره متن مدل انتخاب شده تنظیم می کند. مقدار پیش فرض 3 است.

**مدل Rerank:** بعد از پیکربندی کلید API مدل Rerank در صفحه "ارائه دهندگان مدل"، می توانید "مدل Rerank" را در تنظیمات بازیابی فعال کنید. سیستم بعد از بازیابی متن کامل، re-ranking معنایی را بر روی نتایج اسناد بازیابی شده انجام می دهد تا نتایج رتبه بندی بهینه سازی شوند. هنگامی که مدل Rerank تنظیم می شود، تنظیمات TopK و آستانه امتیاز فقط در مرحله Rerank اثر دارند.

### جستجوی ترکیبی

همزمان جستجوی متن کامل و جستجوی برداری را انجام می دهد، یک مرحله re-ranking را برای انتخاب بهترین نتایج تطبیق یافته با پرس و جوی کاربر از هر دو نوع نتایج پرس و جو اعمال می کند. نیازمند پیکربندی API مدل Rerank است.

<figure><img src="../../../.gitbook/assets/image (118).png" alt="" width="563"><figcaption><p>تنظیمات جستجوی ترکیبی</p></figcaption></figure>

**TopK:** برای فیلتر کردن بخش های متنی که بیشترین شباهت را به پرس و جوی کاربر دارند، استفاده می شود. سیستم به طور پویا تعداد بخش ها را بر اساس اندازه پنجره متن مدل انتخاب شده تنظیم می کند. مقدار پیش فرض 3 است.

**مدل Rerank:** بعد از پیکربندی کلید API مدل Rerank در صفحه "ارائه دهندگان مدل"، می توانید "مدل Rerank" را در تنظیمات بازیابی فعال کنید. سیستم بعد از بازیابی ترکیبی، re-ranking معنایی را بر روی نتایج اسناد بازیابی شده انجام می دهد تا نتایج رتبه بندی بهینه سازی شوند. هنگامی که مدل Rerank تنظیم می شود، تنظیمات TopK و آستانه امتیاز فقط در مرحله Rerank اثر دارند.

### تنظیم حالت بازیابی هنگام ایجاد مجموعه داده

با ورود به صفحه "مجموعه داده -> ایجاد مجموعه داده" و پیکربندی تنظیمات بازیابی، حالت های مختلف بازیابی را تنظیم کنید.

<figure><img src="../../../.gitbook/assets/image (119).png" alt="" width="563"><figcaption><p>تنظیم حالت بازیابی هنگام ایجاد مجموعه داده</p></figcaption></figure>

### تغییر حالت بازیابی در تنظیمات مجموعه داده

با ورود به صفحه "مجموعه داده -> انتخاب مجموعه داده -> تنظیمات"، حالت بازیابی یک مجموعه داده موجود را تغییر دهید.

<figure><img src="../../../.gitbook/assets/image (120).png" alt="" width="563"><figcaption><p>تغییر حالت بازیابی در تنظیمات مجموعه داده</p></figcaption></figure>

### تغییر حالت بازیابی در چیدمان راهنما

با ورود به صفحه "چیدمان راهنما -> متن -> انتخاب مجموعه داده -> تنظیمات"، حالت بازیابی را هنگام ایجاد یک برنامه تغییر دهید.

<figure><img src="../../../.gitbook/assets/image (121).png" alt=""><figcaption><p>تغییر حالت بازیابی در چیدمان راهنما</p></figcaption></figure>


